<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Meter Connect</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Meter Connect</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f6fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 400px;
      width: 100%;
    }

    h2 {
      margin-bottom: 25px;
      color: #333;
      font-size: 20px;
    }

    input[type="file"] {
      display: block;
      margin: 15px auto;
      border: 2px dashed #0078d7;
      padding: 12px;
      border-radius: 8px;
      background: #f9f9f9;
      cursor: pointer;
      transition: 0.3s;
    }

    input[type="file"]:hover {
      background: #eef6ff;
    }

    button {
      margin-top: 15px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      background: #0078d7;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #005a9e;
    }
    </style>
</head>
<body>

  <table>
    <tr><td><h3>Single Meter Connect of Genus DVVNL</h3></td></tr>
    <tr><td align="center"><input type="text" id="mid"></td></tr>
    <tr><td align="center"><button onclick="bulkDisconnect()">Connect</button></td></tr>
  </table>
  
  <script>
    async function bulkDisconnect() {
      const apiUrl = "https://mdm.genusdvvnl.in/urjaservice/api/v1/ConnectDisconnect/AddConnectDisconnectJob";
 const token ="eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJCUk55ZnhfSXhLZ3BoYlRCT2lxdHFkdzFUcTJQSUxRUVpyai1TM01KVkY4In0.eyJleHAiOjE3NTg5MTkyNjEsImlhdCI6MTc1ODg4MzI2MSwiYXV0aF90aW1lIjoxNzU4ODgzMjUyLCJqdGkiOiJkNjQ1MzNhMS04NTgzLTRiYTktYmMyZC0wYTliMTllNzg2ZGUiLCJpc3MiOiJodHRwczovL21kbS5nZW51c2R2dm5sLmluL3JlYWxtcy9nZW51c3Bvd2VyIiwiYXVkIjpbImFzc2V0bWFuYWdlbWVudC1hcGkiLCJwcmVwYXktYXBpIiwiZWFhLWFwaSIsIm1kbS1hcGkiLCJ2ZWUtYXBpIiwiYWNjb3VudCJdLCJzdWIiOiI4Y2I1NTMxZi1jNTljLTQ0YzMtYWZkNi1hMmUyNmViNTk4ZjAiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJtZG0tdWkiLCJub25jZSI6IlRYSmtOVWxRYVUxUFoyTTJSVGh6ZFUwNGEySjRkWE52WDJSSmFIWlhiR1JtTWtkUU5XbElSbWx0V1RWcSIsInNlc3Npb25fc3RhdGUiOiI4NWI3M2ZlNC1iOGRhLTRkNGYtODRkZi0zYzVmOWZiZTg1NzUiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwgb2ZmbGluZV9hY2Nlc3MiLCJzaWQiOiI4NWI3M2ZlNC1iOGRhLTRkNGYtODRkZi0zYzVmOWZiZTg1NzUiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInJvbGVzIjpbInByZXBheS1yb2xlIiwibWRtLXJvbGUiLCJkZWZhdWx0LXJvbGVzLWdlbnVzcG93ZXIiLCJ2ZWUtcm9sZSIsImVhYS1yb2xlIiwib2ZmbGluZV9hY2Nlc3MiLCJhc3NldG1hbmFnZW1lbnQtcm9sZSIsInVtYV9hdXRob3JpemF0aW9uIl0sIm5hbWUiOiJzZG8gb3JhaS5paSIsInVzZXItY2xhaW1zIjpbIk1JLVZpZXciLCJtZG0tc2luZ2xlLWZlZWRlci1kYXNoYm9hcmQiLCJtZG0tdmlldy1kYXRhIiwiTWV0ZXItVmlldyIsInByZXBheS12aWV3LWRhdGEiLCJtZG0tdXBwY2wtZGFzaGJvYXJkIiwiYXNzZXRtYW5hZ2VtZW50LXZpZXctZGF0YSIsImVhYS12aWV3LWRhdGEiLCJtZG0tcmVwb3J0cyIsInZlZS12aWV3LWRhdGEiLCJtZG0tc2V0LWNvbm5lY3Rpb24iLCJtZG0tZHQtZGFzaGJvYXJkIl0sInByaW9yaXR5LWxldmVsIjoiMSIsInByZWZlcnJlZF91c2VybmFtZSI6InNkby5vcmFpMiIsImdpdmVuX25hbWUiOiJzZG8iLCJmYW1pbHlfbmFtZSI6Im9yYWkuaWkiLCJlbWFpbCI6InNkby5vcmFpLmlpQGR2dm5sLm9yZyJ9.MpM4JKu5dTMdbbm2Zx4vFgOExhj_RwZBcRWm4BxEh0YL-Bx8M1Yptci-76jg4IVoKEUD1NkXoR6lKLfdDHz59CkUPonrgmgHmWmyvrB0O3cgmXXx0kyLrB46K617Annhgjj2kFXbUQ4JDVjTeyyiXCiqakaOd3tCjdnP-aFnRg16m0n_ywV4w_2DWh6l-GYgSlba3hgkKmhJO31l-sjbc3SjnhQnPGcw5S6oSU8AKxRY1-jE9_g7v75UX1H5X2DvHeVgs_mu8qjeG6BwGd3UTNKiFgiC2X333a1sLPIEt9dVsCAoCvQOc430W3SzyQuMtI-1fHjzwIiEw9nYyldDKQ";  

const userId= "8cb5531f-c59c-44c3-afd6-a2e26eb598f0";// Replace with actual user id

            // Assume first column has meter IDs
      const meterid = document.getElementById("mid").value;

      console.log("Loaded Meter IDs:", meterid);

      // Send disconnect request for each meter ID
    
        const payload = {
          id: 0,
          jobname: "Disconnect",
          jobtype: "SingleMeter",
          jobcategory: "ConnectDisconnect",
          frequencytype: "On Demand",
          frequencyinterval: "",
          meterIdList: [meterid],
          jobparameters: "LOAD_SWITCH_OPERATION",
          payload: "Connect",
          remarks: "",
          reason: "paid",
          password: null,
          userid: userId,
          jobid: "",
          cronexpression: "",
          priority: 2,
          virtualgroupid: 0
        };

        try {
          const response = await fetch(apiUrl, {
            method: "PUT",
            headers: {
              "Authorization": "Bearer " + token,
              "Content-Type": "application/json",
              "Accept": "application/json"
            },
            body: JSON.stringify(payload)
          });

          const text = await response.text();
          console.log(`Meter ${meterid} â†’ Response Code:`, response.status);
          console.log("Response Body:", text);
          alert("Meter Connected Succussfully : " + meterid);
        } catch (error) {
          console.error(`Error connecting meter ${meterid}:`, error);
        }
      
    }
  </script>
</body>

</html>
